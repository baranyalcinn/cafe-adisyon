appId: com.caffio.cafeadisyon
productName: Cafe Adisyon
electronVersion: 39.3.0

directories:
  buildResources: build
  output: dist

compression: store
asar: true

# CRITICAL: Only include bundled output - NO node_modules
# This completely bypasses node-module-collector (fixes OOM)
files:
  - out/**/*
  - package.json
  - '!node_modules'
  - '!node_modules/**/*'
  - '!.git'
  - '!.github'
  - '!.vscode'
  - '!src'
  - '!prisma'

# Native modules copied via extraFiles (not subject to collector)
extraFiles:
  # LibSQL native bindings (Windows x64)
  - from: node_modules/@libsql/win32-x64-msvc
    to: node_modules/@libsql/win32-x64-msvc
    filter:
      - '**/*'

  # LibSQL core runtime
  - from: node_modules/libsql
    to: node_modules/libsql
    filter:
      - '**/*'
      - '!node_modules'

  # LibSQL client dependencies
  - from: node_modules/@libsql/core
    to: node_modules/@libsql/core
  - from: node_modules/@libsql/hrana-client
    to: node_modules/@libsql/hrana-client
  - from: node_modules/@libsql/client
    to: node_modules/@libsql/client
  - from: node_modules/@libsql/isomorphic-fetch
    to: node_modules/@libsql/isomorphic-fetch
  - from: node_modules/@libsql/isomorphic-ws
    to: node_modules/@libsql/isomorphic-ws

  # Shared dependencies
  - from: node_modules/detect-libc
    to: node_modules/detect-libc
  - from: node_modules/js-base64
    to: node_modules/js-base64
  - from: node_modules/promise-limit
    to: node_modules/promise-limit

asarUnpack:
  - '**/*.node'
  - '**/node_modules/@libsql/**'
  - '**/node_modules/libsql/**'

npmRebuild: false
buildDependenciesFromSource: false

win:
  executableName: cafe-adisyon
  icon: build/icon.ico
  target:
    - target: portable
      arch: x64

portable:
  artifactName: ${productName}-Portable-${version}.${ext}
  requestExecutionLevel: user

extraResources:
  - from: prisma/dev.db
    to: initial.db
  - from: prisma/schema.prisma
    to: schema.prisma

appId: com.caffio.caffio
productName: Caffio
electronVersion: 40.4.0

publish:
  provider: github
  owner: baranyalcinn
  repo: cafe-adisyon
  releaseType: release

detectUpdateChannel: true

directories:
  buildResources: build
  output: dist

compression: maximum
asar: true
files:
  - out/**/*
  - package.json
  # Whitelist approach: Only include EXACTLY what we need to avoid OOM
  - node_modules/@libsql/**
  - node_modules/libsql/**
  - node_modules/@prisma/client/**
  - node_modules/@prisma/adapter-libsql/**
  - node_modules/.prisma/client/**
  - node_modules/bufferutil/**
  - node_modules/utf-8-validate/**
  - node_modules/detect-libc/**
  - node_modules/@neon-rs/load/**
  - node_modules/electron-updater/**
  - node_modules/electron-log/**
  - node_modules/builder-util-runtime/**
  - node_modules/fs-extra/**
  - node_modules/semver/**
  - node_modules/lodash.escaperegexp/**
  - node_modules/js-yaml/**
  - node_modules/lazy-val/**
  - node_modules/lodash.isequal/**
  - node_modules/tiny-typed-emitter/**
  - node_modules/graceful-fs/**
  - node_modules/jsonfile/**
  - node_modules/universalify/**
  - node_modules/sax/**
  - node_modules/debug/**

  # Kaynak kodları hariç tut
  - '!**/*.ts'
  - '!**/*.tsx'
  - '!**/*.map'
  - '!**/README.md'
  - '!**/LICENSE'
  - '!**/CHANGELOG.md'
  - '!.git'
  - '!.github'
  - '!.vscode'
  - '!src'
  - '!prisma/*.db'
  - '!prisma/*.db-*'

# ASAR dışında tutulması gereken native modüller
asarUnpack:
  - '**/*.node'
  - 'node_modules/@libsql/**/*'
  - 'node_modules/libsql/**/*'
  - 'node_modules/@neon-rs/**/*'
  - 'node_modules/.prisma/**/*'
  - 'node_modules/bufferutil/**/*'
  - 'node_modules/utf-8-validate/**/*'
  - 'node_modules/detect-libc/**/*'

npmRebuild: false
buildDependenciesFromSource: false

win:
  executableName: cafe-adisyon
  icon: resources/icon.png
  target:
    - target: nsis
      arch: x64

nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  shortcutName: Caffio
  artifactName: ${productName}-Setup-${version}.${ext}
  uninstallDisplayName: ${productName}
  createDesktopShortcut: always

extraResources:
  - from: resources
    to: resources
  - from: prisma/dev.db
    to: initial.db
  - from: prisma/schema.prisma
    to: schema.prisma

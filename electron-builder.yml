appId: com.caffio.caffio
productName: Caffio
electronVersion: 39.3.0

directories:
  buildResources: build
  output: dist

compression: store
asar: true

files:
  - out/**/*
  - package.json
  # Explicitly include externalized database packages
  # This avoids OOM by skipping node-module scanning while ensuring runtime availability
  - node_modules/@prisma/**/*
  - node_modules/.prisma/**/*
  - node_modules/@libsql/**/*
  - node_modules/libsql/**/*
  - node_modules/js-base64/**/*
  - node_modules/promise-limit/**/*
  - node_modules/@neon-rs/load/**/*
  - node_modules/detect-libc/**/*
  - node_modules/js-base64/**/*
  - node_modules/promise-limit/**/*
  - node_modules/async-mutex/**/*

  # Exclude everything else
  - '!node_modules/**/node_modules'
  - '!.git'
  - '!.github'
  - '!.vscode'
  - '!src'
  - '!prisma'

# Native .node binaries must be accessible outside ASAR
# These will be automatically unpacked by electron-builder if they are native
asarUnpack:
  - '**/*.node'
  - 'node_modules/@prisma/**/*'
  - 'node_modules/.prisma/**/*'
  - 'node_modules/@libsql/**/*'

npmRebuild: false
buildDependenciesFromSource: false

win:
  executableName: cafe-adisyon
  icon: resources/icon.png
  target:
    - target: portable
      arch: x64

portable:
  artifactName: ${productName}-Portable-${version}.${ext}
  requestExecutionLevel: user

extraResources:
  - from: resources
    to: resources
  - from: prisma/dev.db
    to: initial.db
  - from: prisma/schema.prisma
    to: schema.prisma

appId: com.caffio.app
productName: Caffio

publish:
  provider: github
  owner: baranyalcinn
  repo: cafe-adisyon
  releaseType: release

detectUpdateChannel: true

directories:
  buildResources: build
  output: dist

compression: maximum
asar: true

# Sadece gerekli dil dosyalarını paketle (~80 MB kazanç)
electronLanguages:
  - en-US
  - tr
files:
  - out/**/*
  - package.json

  # Exclude source code
  - '!**/*.ts'
  - '!**/*.tsx'
  - '!**/*.map'
  - '!**/README.md'
  - '!**/LICENSE'
  - '!**/CHANGELOG.md'
  - '!.git'
  - '!gitignore'
  - '!.github'
  - '!.vscode'
  - '!src'
  - '!prisma/*.db'
  - '!prisma/*.db-*'

  # Native Module Build Cleanup (Size Optimization)
  - '!**/node_modules/better-sqlite3/deps/**'
  - '!**/node_modules/better-sqlite3/src/**'
  - '!**/node_modules/**/*.c'
  - '!**/node_modules/**/*.h'
  - '!**/node_modules/**/build/Release/*.obj'
  - '!**/node_modules/**/build/Release/*.iobj'
  - '!**/node_modules/**/build/Release/*.pdb'
  - '!**/node_modules/**/build/Release/*.lib'

# ASAR dışında tutulması gereken native modüller
# **/*.node tüm .node binary'leri yakalar — better-sqlite3'ün JS dosyaları ASAR'da kalabilir
asarUnpack:
  - '**/*.node'
  - 'node_modules/.prisma/**/*'
  - 'node_modules/bufferutil/**/*'
  - 'node_modules/utf-8-validate/**/*'
  - 'node_modules/detect-libc/**/*'

npmRebuild: true
buildDependenciesFromSource: false

win:
  executableName: cafe-adisyon
  icon: resources/icon.png
  target:
    - target: nsis
      arch: x64

nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  shortcutName: Caffio
  artifactName: ${productName}-Setup-${version}.${ext}
  uninstallDisplayName: ${productName}
  createDesktopShortcut: always

extraResources:
  - from: resources
    to: resources
  # Temiz kurulum için şablon DB (dev.db yerine — test verisi kullanıcıya gitmesin)
  - from: prisma/template.db
    to: initial.db
  - from: prisma/schema.prisma
    to: schema.prisma

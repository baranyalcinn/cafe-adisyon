appId: com.caffio.cafeadisyon
productName: Cafe Adisyon
electronVersion: 39.3.0

directories:
  buildResources: build
  output: dist

compression: store
asar: true

files:
  - out/**/*
  - package.json

  # SEÇİCİ NODE_MODULES - Sadece runtime'da gereken native modüller
  # Bu yaklaşım electron-builder'ın node-module-collector'ını bypass eder
  # ve OOM sorununu çözer

  # LibSQL native bindings
  - node_modules/@libsql/**
  - node_modules/libsql/**
  - node_modules/@neon-rs/**
  - node_modules/detect-libc/**

  # Prisma runtime
  - node_modules/@prisma/client/**
  - node_modules/@prisma/adapter-libsql/**
  - node_modules/@prisma/client-runtime-utils/**
  - node_modules/@prisma/engines/**
  - node_modules/prisma-client-generated/**
  - node_modules/.prisma/**

  # Diğer gerekli runtime deps (libsql'in ihtiyaç duyduğu)
  - node_modules/js-base64/**
  - node_modules/promise-limit/**
  - node_modules/@libsql/hrana-client/**
  - node_modules/@libsql/core/**
  - node_modules/@libsql/isomorphic-fetch/**
  - node_modules/@libsql/isomorphic-ws/**

  # Hariç tutulanlar
  - '!.git'
  - '!.github'
  - '!.vscode'
  - '!src'
  - '!prisma'

asarUnpack:
  - '**/*.node'
  - '**/better-sqlite3/**'
  - '**/@prisma/engines/**'
  - '**/query-engine-windows.exe'
  - '**/schema.prisma'

npmRebuild: false
buildDependenciesFromSource: false

win:
  executableName: cafe-adisyon
  icon: build/icon.ico
  target:
    - target: portable
      arch: x64

portable:
  artifactName: ${productName}-Portable-${version}.${ext}
  requestExecutionLevel: user

extraResources:
  - from: prisma/dev.db
    to: initial.db
  - from: prisma/schema.prisma
    to: schema.prisma

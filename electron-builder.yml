appId: com.caffio.cafeadisyon
productName: Cafe Adisyon
electronVersion: 39.3.0

directories:
  buildResources: build
  output: dist

# Hız için sıkıştırma yok, düzen için paketleme var
compression: store
asar: true

files:
  - out/**/*
  - package.json

  # --- TEMİZLİK OPERASYONU ---
  # 1. Her şeyi engelle
  - '!node_modules'
  - '!node_modules/**'

  # 2. Sadece PRISMA CLIENT'ı al (CLI'yı alma!)
  - 'node_modules/.prisma/**/*' # Oluşturulan client (Önemli)
  - 'node_modules/@prisma/client/**/*' # Client kütüphanesi

  # 3. SQLite'ı al
  - 'node_modules/better-sqlite3/**/*'

  # 4. Gereksiz ne varsa engelle (Prisma CLI dahil)
  - '!node_modules/prisma' # <-- İŞTE RAM'İ PATLATAN SUÇLU BUYDU
  - '!node_modules/@prisma/engines' # Motorları asar içine koyma (ExtraResources ile alacağız)
  - '!.git'
  - '!.github'
  - '!.vscode'
  - '!src'
  - '!prisma'

# Native modülleri paket dışına çıkar
asarUnpack:
  - '**/*.node'
  - '**/better-sqlite3/**'
  # Prisma client'ın bazen ihtiyaç duyduğu dosyalar
  - '**/@prisma/client/**'

npmRebuild: false
buildDependenciesFromSource: false

win:
  executableName: cafe-adisyon
  icon: build/icon.ico
  target:
    - target: portable
      arch: x64

portable:
  artifactName: ${productName}-Portable-${version}.${ext}
  requestExecutionLevel: user

extraResources:
  - from: prisma/dev.db
    to: initial.db
  - from: prisma/schema.prisma
    to: schema.prisma
  # Windows motorunu exe'nin yanına koyuyoruz (RAM tasarrufu)
  # Bu dosya build sırasında node_modules içinde vardır
  - from: node_modules/@prisma/engines/query_engine-windows.dll.node
    to: query_engine-windows.dll.node
  - from: node_modules/.prisma/client/query_engine-windows.dll.node
    to: query_engine-windows.dll.node
  # Prisma sürümüne göre motor ismi .exe veya .dll.node olabilir.
  # Garanti olsun diye exe'yi de ekleyelim, yoksa hata vermez sadece kopyalamaz.
  - from: node_modules/@prisma/engines/query-engine-windows.exe
    to: query-engine-windows.exe

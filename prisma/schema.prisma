generator client {
  provider   = "prisma-client"
  output     = "../src/generated/prisma"
  engineType = "client"
}

datasource db {
  provider = "sqlite"
}

model Product {
  id         String      @id @default(cuid())
  name       String
  price      Int
  categoryId String
  isFavorite Boolean     @default(false)
  isDeleted  Boolean     @default(false)
  orderItems OrderItem[]
  category   Category    @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([isFavorite])
  @@index([isDeleted])
  @@index([name])
}

model Category {
  id       String    @id @default(cuid())
  name     String
  icon     String    @default("utensils")
  products Product[]
  isDeleted Boolean  @default(false)

  @@index([isDeleted])
}

model Table {
  id     String  @id @default(cuid())
  name   String  @unique
  orders Order[]
}

model Order {
  id          String        @id @default(cuid())
  tableId     String
  status      String        @default("OPEN")
  totalAmount Int           @default(0)
  isLocked    Boolean       @default(false)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime?     @updatedAt
  table       Table         @relation(fields: [tableId], references: [id])
  items       OrderItem[]
  payments    Transaction[]

  @@index([tableId])
  @@index([tableId, createdAt])
  @@index([tableId, status])
  @@index([status, createdAt])
  @@index([status])
  @@index([createdAt])
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  unitPrice Int
  isPaid    Boolean @default(false)
  product   Product @relation(fields: [productId], references: [id])
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([productId])
  @@index([isPaid])
}

model Transaction {
  id            String   @id @default(cuid())
  orderId       String
  amount        Int
  paymentMethod String
  createdAt     DateTime @default(now())
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([createdAt])
  @@index([paymentMethod])
}

model DailySummary {
  id            String   @id @default(cuid())
  date          DateTime @unique
  totalCash     Int      @default(0)
  actualCash    Int?     @default(0)
  totalCard     Int      @default(0)
  totalExpenses Int      @default(0)
  netProfit     Int      @default(0)
  cancelCount   Int      @default(0)
  totalVat      Int      @default(0)
  orderCount    Int      @default(0)
  totalRevenue  Int      @default(0)
  createdAt     DateTime @default(now())

  @@index([date])
}

model ActivityLog {
  id        String   @id @default(cuid())
  action    String
  tableName String?
  userName  String?
  details   String?
  createdAt DateTime @default(now())

  @@index([createdAt])
  @@index([action])
}

model AppSettings {
  id               String  @id @default("app-settings")
  adminPin         String  @default("1234")
  securityAnswer   String?
  securityQuestion String?
}

model Expense {
  id          String   @id @default(cuid())
  description String
  amount      Int
  category    String?
  paymentMethod String   @default("CASH") // CASH, CARD
  createdAt   DateTime @default(now())

  @@index([createdAt])
}

model MonthlyReport {
  id            String   @id @default(cuid())
  monthDate     DateTime @unique
  totalRevenue  Int      @default(0)
  totalExpenses Int      @default(0)
  netProfit     Int      @default(0)
  orderCount    Int      @default(0)
  updatedAt     DateTime @updatedAt

  @@index([monthDate])
}
